var H=Object.defineProperty,K=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var T=(t,o,s)=>o in t?H(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,A=(t,o)=>{for(var s in o||(o={}))G.call(o,s)&&T(t,s,o[s]);if(B)for(var s of B(o))P.call(o,s)&&T(t,s,o[s]);return t},O=(t,o)=>K(t,x(o));import{an as J,as as Q,am as F,aq as W,u as X,r as Y,au as Z,E as f,o as $,b as v,av as ee,t as te,d,e as g,n as j,w as i,j as l,f as U,q as oe,F as le,g as N,h as q,k as z,i as ae}from"./vendor.c58b0721.js";import{a as I,B as re,E as ne,T as ie}from"./index.esm.76000dbd.js";import{_ as se,a as de,c as S,u as me}from"./index.83e2ae4f.js";function ue(t,o){const{link:s="",fileName:n=""}=t;return`<a data-w-e-type="attachment" data-w-e-is-void data-w-e-is-inline data-link="${s}" data-fileName="${n}" href="${s}" target="_blank">${n}</a>`}const ce={type:"attachment",elemToHtml:ue};I.elemsToHtml=[ce];re.registerModule(I);const fe={name:"news_add",components:{Plus:J,Delete:Q,Editor:ne,Toolbar:ie},setup(){F(null);const t=F(null),o=F(null),s=W(),n=X(),{id:p}=s.query,r=Y({token:"Bearer "+de("token")||"",id:p,select_flag:!1,Form:{img_url:"",img:"",office_id:"",title:"",content:"",release_time:F(""),status:"0",disabled:!0,fileList:[],list:[]},rules:{img:[{required:!0,message:"\u56FE\u7247\u5FC5\u987B",trigger:["change"]}],office_id:[{required:!0,message:"\u90E8\u95E8\u5FC5\u987B",trigger:["change"]}],title:[{required:"true",message:"\u6807\u9898",trigger:["change"]}],release_time:[{required:"true",message:"\u53D1\u5E03\u65F6\u95F4\u5FC5\u987B",trigger:["change"]}],status:[{required:!1,message:"\u72B6\u6001\u5FC5\u987B",trigger:["change"]}]}}),_=Z(),k={insertKeys:{index:31,keys:["uploadAttachment"]}},c={placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9...",hoverbarKeys:{attachment:{menuKeys:["downloadAttachment"]}},MENU_CONF:{uploadImage:{server:S,fieldName:"file",maxFileSize:2*1024*1024,maxNumberOfFiles:10,allowedFileTypes:["image/*"],meta:{basket:"img"},headers:{Authorization:r.token},customInsert:function(e,a){a(e.data.src,e.data.file_name,e.data.src)},onError(e,a,u){f.error(new Error(a).message),console.log(e,a,u)}},uploadVideo:{server:S,fieldName:"file",maxFileSize:100*1024*1024,allowedFileTypes:["video/*"],meta:{basket:"video"},headers:{Authorization:r.token},customInsert:function(e,a){a(e.data.src)},onError(e,a,u){f.error(new Error(a).message),console.log(e,a,u)}},uploadAttachment:{server:S,fieldName:"file",maxFileSize:10*1024*1024,meta:{basket:"attachment"},headers:{Authorization:r.token},customInsert:function(e,a,u){u(`${a.name}`,e.data.src)},onError(e,a,u){f.error(new Error(a).message),console.log(e,a,u)}}}},y=e=>{_.value=e};$(()=>{h(),p&&v.get(`/api/back/technicalOfficeDynamics/${p}`).then(e=>{r.Form={img_url:e.data.url||"",img:e.data.file_id,office_id:e.data.office_id,title:e.data.title,content:e.data.content,release_time:e.data.release_time,status:String(e.data.status),fileList:[{url:e.data.url}],disabled:!0},r.select_flag=!0})}),ee(()=>{const e=_.value;e!=null&&e.destroy()});const h=()=>{v.get("/api/back/technicalOffices").then(e=>{r.Form.list=e.data})},V=()=>{t.value.validate(e=>{if(e){let a=v.post,u={img:r.Form.img,office_id:r.Form.office_id,title:r.Form.title,content:r.Form.content,release_time:r.Form.release_time,status:r.Form.status},b="/api/back/technicalOfficeDynamics";p&&(u.release_time=r.Form.release_time,a=v.put,b=`/api/back/technicalOfficeDynamics/${p}`),a(b,u).then(()=>{p?f.success("\u4FEE\u6539\u6210\u529F"):f.success("\u6DFB\u52A0\u6210\u529F"),n.push({path:"/technicaloffice-dynamic"})})}})},C=e=>{if((e.size/1024/1024).toFixed(2)>2)return f.error("\u4E0A\u4F20\u7684\u56FE\u7247\u5927\u4E8E2\u5146"),!1;const u=e.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(u))return f.error("\u8BF7\u4E0A\u4F20 jpg\u3001jpeg\u3001png \u683C\u5F0F\u7684\u56FE\u7247"),!1},w=e=>{f.success("\u4E0A\u4F20\u6210\u529F"),r.Form.img_url=e.data.src||"",r.Form.img=e.data.id||""},E=e=>{f.error("\u4E0A\u4F20\u5931\u8D25")},R=e=>{o.value.clearFiles(),r.Form.img="",r.Form.img_url="",r.Form.fileList=[]};return O(A({},te(r)),{editorRef:_,mode:"default",toolbarConfig:k,editorConfig:c,handleCreated:y,uploadRef:o,Ref:t,submitAdd:V,uploadImgServer:me,handleBeforeUpload:C,handleUrlSuccess:w,handleUrlError:E,handleRemove:R})}},pe=["src"],_e={class:"el-upload-list__item-actions"},ge={style:{border:"1px solid #ccc","z-index":"100"}},he=z("\u5DF2\u5BA1\u6838"),be=z("\u5F85\u5BA1\u6838");function Fe(t,o,s,n,p,r){const _=d("el-option"),k=d("el-select"),c=d("el-form-item"),y=d("plus"),h=d("el-icon"),V=d("delete"),C=d("el-upload"),w=d("el-input"),E=d("Toolbar"),R=d("Editor"),e=d("el-date-picker"),a=d("el-radio"),u=d("el-radio-group"),b=d("el-button"),D=d("el-form"),L=d("el-card");return g(),j(L,{style:{"min-height":"100%"}},{default:i(()=>[l(D,{model:t.Form,rules:t.rules,ref:"Ref","label-width":"100px"},{default:i(()=>[l(c,{label:"\u90E8\u95E8",prop:"office_id"},{default:i(()=>[l(k,{modelValue:t.Form.office_id,"onUpdate:modelValue":o[0]||(o[0]=m=>t.Form.office_id=m),placeholder:"Select",filterable:"",disabled:t.select_flag},{default:i(()=>[(g(!0),U(le,null,oe(t.Form.list,m=>(g(),j(_,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(c,{label:"\u5C01\u9762\u56FE",prop:"img"},{default:i(()=>[l(C,{ref:"uploadRef",action:n.uploadImgServer,data:{basket:"img"},limit:1,"list-type":"picture-card","thumbnail-mode":"true",headers:{Authorization:t.token},"before-upload":n.handleBeforeUpload,"on-success":n.handleUrlSuccess,"on-error":n.handleUrlError,"auto-upload":!0,"file-list":t.Form.fileList},{default:i(()=>[l(h,null,{default:i(()=>[l(y)]),_:1})]),file:i(({file:m})=>[N("div",null,[t.Form.img_url?(g(),U("img",{key:0,class:"el-upload-list__item-thumbnail",src:t.Form.img_url,alt:""},null,8,pe)):q("",!0),N("span",_e,[t.Form.disabled?(g(),U("span",{key:0,class:"el-upload-list__item-delete",onClick:o[1]||(o[1]=(...M)=>n.handleRemove&&n.handleRemove(...M))},[l(h,null,{default:i(()=>[l(V)]),_:1})])):q("",!0)])])]),_:1},8,["action","headers","before-upload","on-success","on-error","file-list"])]),_:1}),l(c,{label:"\u6807\u9898",prop:"title"},{default:i(()=>[l(w,{modelValue:t.Form.title,"onUpdate:modelValue":o[2]||(o[2]=m=>t.Form.title=m),placeholder:"\u8BF7\u8F93\u5165\u6807\u9898",type:"text"},null,8,["modelValue"])]),_:1}),l(c,{label:"\u5185\u5BB9",prop:"content"},{default:i(()=>[N("div",ge,[l(E,{style:{"border-bottom":"1px solid #ccc"},editor:n.editorRef,defaultConfig:n.toolbarConfig,mode:n.mode},null,8,["editor","defaultConfig","mode"]),l(R,{style:{height:"500px","overflow-y":"hidden"},modelValue:t.Form.content,"onUpdate:modelValue":o[3]||(o[3]=m=>t.Form.content=m),defaultConfig:n.editorConfig,mode:n.mode,onOnCreated:n.handleCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])]),_:1}),l(c,{label:"\u53D1\u5E03\u65F6\u95F4",prop:"release_time"},{default:i(()=>[l(e,{modelValue:t.Form.release_time,"onUpdate:modelValue":o[4]||(o[4]=m=>t.Form.release_time=m),type:"datetime","default-value":new Date,placeholder:"\u8BF7\u8F93\u5165\u53D1\u5E03\u65F6\u95F4"},null,8,["modelValue","default-value"])]),_:1}),l(c,{label:"\u72B6\u6001",prop:"status"},{default:i(()=>[l(u,{modelValue:t.Form.status,"onUpdate:modelValue":o[5]||(o[5]=m=>t.Form.status=m),disabled:""},{default:i(()=>[l(a,{label:"1"},{default:i(()=>[he]),_:1}),l(a,{label:"0"},{default:i(()=>[be]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(c,null,{default:i(()=>[l(b,{type:"primary",onClick:o[6]||(o[6]=m=>n.submitAdd())},{default:i(()=>[z(ae(t.id?"\u7ACB\u5373\u4FEE\u6539":"\u7ACB\u5373\u521B\u5EFA"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})}var Ce=se(fe,[["render",Fe]]);export{Ce as default};
